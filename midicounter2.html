<!doctype html>
<html>
<head>
  <style>
    body {
      font-family: monospace;
    }
    #roll {
      display: flex;
      flex-direction: column-reverse; /* C2 at bottom */
      line-height: 1.4;
    }
  </style>
</head>

<body>
  <select id="midiSelect"></select>
  <pre id="roll"></pre>

<script>
const NOTE_START = 36; // C2
const NOTE_END   = 84; // C6

let counters = {};
let currentInput = null;

// init counters
for (let n = NOTE_START; n <= NOTE_END; n++) {
  counters[n] = 0;
}

function noteName(n) {
  const names = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
  return names[n % 12] + Math.floor(n / 12 - 1);
}

function render() {
  let out = '';
  for (let n = NOTE_START; n <= NOTE_END; n++) {
    out += `${noteName(n).padEnd(4)} : ${counters[n]}\n`;
  }
  document.getElementById('roll').textContent = out;
}

navigator.requestMIDIAccess().then(midi => {
  const select = document.getElementById("midiSelect");

  for (let input of midi.inputs.values()) {
    const opt = document.createElement("option");
    opt.value = input.id;
    opt.text = input.name;
    select.appendChild(opt);
  }

  select.onchange = () => {
    if (currentInput) currentInput.onmidimessage = null;
    currentInput = midi.inputs.get(select.value);
    currentInput.onmidimessage = msg => {
      const [status, note, vel] = msg.data;
      if ((status & 0xf0) === 0x90 && vel > 0) {
        if (note >= NOTE_START && note <= NOTE_END) {
          counters[note]++;
          render();
        }
      }
    };
  };
});

render();
</script>
</body>
</html>
